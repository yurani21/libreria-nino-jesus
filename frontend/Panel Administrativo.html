<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style admin.css">
    <title>Panel de Administraci√≥n - Inventario</title>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h2>Panel de Administraci√≥n</h2>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#">Inventario</a></li>
                    <li><a href="#">Divino Ni√±o</a></li>
                    <li><a href="#">Clientes</a></li>
                    <li><a href="#">Reportes</a></li>
                    <li><a href="#">Configuraci√≥n</a></li>
                </ul>
            </nav>
        </aside>
        
        <main class="main-content">
            <header>
                <h1>Gesti√≥n de Inventario</h1>
            </header>

            <section class="dashboard">
                <p>Crea, edita y administra cada detalle de los productos o servicios que vendes.</p>

                <div class="controls">
                    <button class="btn btn-add" onclick="mostrarFormulario()">+ Agregar Producto</button>
                    <select id="filtroCategoria" onchange="filtrarPublicaciones()">
                        <option value="todas">Mostrar todo</option>
                        <option value="libro">Libros</option>
                        <option value="biblia">Biblias</option>
                        <option value="novena">Novenas</option>
                    </select>
                    <input type="text" id="buscador" placeholder="Buscar..." onkeyup="buscarPublicaciones()">
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Nombre</th>
                            <th>Precio</th>
                            <th>Editorial</th>
                            <th>Categor√≠a</th>
                            <th>Imagen</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaPublicaciones"></tbody>
                </table>
            </section>
        </main>
    </div>

    <!-- MODAL AGREGAR -->
    <div class="modal" id="modalAgregar">
        <h3>Nuevo Producto</h3>
        <input type="text" id="codigo" placeholder="C√≥digo" value="">
        <input type="text" id="nombre" placeholder="Nombre">
        <input type="number" id="precio" placeholder="Precio">
        <input type="text" id="editorial" placeholder="Editorial">
        <select id="categoria">
            <option value="libro">Libro</option>
            <option value="biblia">Biblia</option>
            <option value="novena">Novena</option>
        </select>
        <input type="file" id="imagen">
        <button onclick="agregarPublicacion()">Guardar</button>
        <button onclick="cerrarFormulario()">Cancelar</button>
    </div>

    <script>
        async function mostrarPublicaciones() {
            try {
                let response = await fetch("http://localhost:4000/libros");
                let libros = await response.json();
                const tabla = document.getElementById("tablaPublicaciones");
                tabla.innerHTML = "";

                libros.forEach((libro) => {
                    let fila = `
                        <tr>
                            <td>${libro.Id_Libro}</td>
                            <td>${libro.Lib_Titulo}</td>
                            <td>$${parseFloat(libro.Lib_Precio).toFixed(2)}</td>
                            <td>${libro.Lib_Editorial}</td>
                            <td>${libro.Lib_Categoria}</td>
                            <td>
                                <img src="${libro.Lib_Imagen}" alt="Imagen del libro" width="50" height="50">
                            </td>
                            <td>
                                <button onclick="eliminarPublicacion(${libro.Id_Libro})">üóëÔ∏è Eliminar</button>
                            </td>
                        </tr>
                    `;
                    tabla.innerHTML += fila;
                });
            } catch (error) {
                console.error("Error al obtener libros:", error);
            }
        }

        async function agregarPublicacion() {
    let nuevoLibro = {
        Lib_Titulo: document.getElementById("nombre").value,
        Lib_Precio: document.getElementById("precio").value,
        Lib_Categoria: document.getElementById("categoria").value,
        Lib_Editorial: document.getElementById("editorial").value,
        Lib_Codigo: document.getElementById("codigo").value,
        Lib_Imagen: document.getElementById("imagen").value // Si est√°s usando im√°genes, mejor usa un input de tipo "file"
    };

    if (!nuevoLibro.Lib_Titulo || !nuevoLibro.Lib_Precio || !nuevoLibro.Lib_Categoria || !nuevoLibro.Lib_Editorial || !nuevoLibro.Lib_Codigo) {
        alert("Todos los campos son obligatorios");
        return;
    }

    try {
        let response = await fetch("http://localhost:4000/libros", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(nuevoLibro)
        });

        let result = await response.json();
        alert(result.message || "Producto agregado correctamente");
        mostrarPublicaciones();
    } catch (error) {
        console.error("Error al agregar libro:", error);
    }
}

        async function eliminarPublicacion(id) {
            try {
                let response = await fetch(`http://localhost:4000/libros/${id}`, { method: "DELETE" });
                let result = await response.json();
                alert(result.message);
                mostrarPublicaciones();
            } catch (error) {
                console.error("Error al eliminar libro:", error);
            }
        }

        function mostrarFormulario() {
            document.getElementById("modalAgregar").style.display = "block";
        }

        function cerrarFormulario() {
            document.getElementById("modalAgregar").style.display = "none";
            document.getElementById("nombre").value = "";
            document.getElementById("precio").value = "";
            document.getElementById("editorial").value = "";
            document.getElementById("categoria").value = "libro";
        }

        mostrarPublicaciones();
    </script>
</body>
</html>
